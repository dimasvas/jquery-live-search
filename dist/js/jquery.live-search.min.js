/*
    live-searchable
    Copyright (c) 2016 - 2016 Dmitry Vasilenko <dmv.developer@gmail.com>
    Licensed under the MIT license 
    Version: 1.0.0
*/
!function(a,b,c){"use strict";var d=a.fn.liveSearch,e=function(b,c){return this.$element=a(b),this.prevInputValue="",this.options=a.extend({},a.fn.liveSearch.defaults,c),this.validateOnInit(this.options),this.setupEvents(),this};e.prototype={constructor:e,setupEvents:function(){var c=this;this.$element.attr("autocomplete","off"),this.$element.click(function(a){a.stopPropagation()}),a(".lsearch-results").click(function(a){a.stopPropagation()}),a("body").on("mouseenter",".lsearch-results li",function(b){a(".active-lsearch-item").removeClass("active-lsearch-item"),a(b.currentTarget).addClass("active-lsearch-item")}).on("click",".lsearch-results li",function(b){c.loadPage(a("a",a(b.target)))}).click(this.destroySearchContainer),a(b).keydown(function(b){var d=a(".active-lsearch-item a");if(13===b.keyCode&&d.length)return b.preventDefault(),c.loadPage(d),!1}),this.$element.keyup({classContext:this},this.onKeyUp)},onKeyUp:function(b){var c=a(this),d=c.val(),e=b.data.classContext,f=e.options;return e.isNavKey(b.keyCode)?void e.navigate(b.keyCode):void(d!==e.previousInput&&(e.previousInput=d,e.clearResults(),d.length>f.minInput&&(e.prevInputValue=d,setTimeout(function(){e.getData(f)},f.searchDelay))))},getData:function(b){var c=this;a.ajax({url:b.url,method:b.method,data:{data:c.getInputValue(),limit:b.limitResult}}).done(function(a){c.render(c.getPreparedResponse(a))})},getInputValue:function(){return"function"==typeof this.options.beforeRequestSend?this.options.beforeRequestSend(this.$element.val()):this.$element.val()},getPreparedResponse:function(a){return this.options.beforeRender(a)},render:function(a){a.length<1||this.$element.after(this.createItems(a))},createItems:function(b){var c=this.options.data,d=this.getResultsWrapper();return a.each(b,function(b,e){var f=a("<li>"),g=a("<a/>",{"class":"lsearch-item",text:e[c.text],href:e[c.href]}).appendTo(a("<div>"));g.appendTo(f),f.appendTo(d)}),d},getResultsWrapper:function(){var b=this;return a("<div>",{style:"width:"+b.$element.outerWidth()+"px","class":"lsearch-results"})},clearResults:function(){var b=a(".lsearch-results");b.length>0&&b.remove()},isNavKey:function(b){return a.inArray(b,[37,38,39,40])!==-1},navigate:function(b){var c=a(".lsearch-results");if(c.length)switch(b){case 40:this.moveToResult("down",c);break;case 38:this.moveToResult("up",c)}},moveToResult:function(b,c){var d=a(".active-lsearch-item",c),e="active-lsearch-item",f=this.$element;if(!d.length&&"up"===b)return void f.val(this.prevInputValue);if(d.length)"down"===b?this.moveDown(f,d,e):this.moveUp(f,d,e);else{var g=a("li",c).first();g.addClass(e),a(f).val(a(".lsearch-item",g).text())}},moveUp:function(b,c,d){var e=c.removeClass(d).prev();return e.length||b.val()===this.prevInputValue?(e.addClass(d),void b.val(a(".lsearch-item",e).text())):(b.val(this.prevInputValue),void b.focus())},moveDown:function(b,c,d){var e=c.next();e.length&&(c.removeClass(d),e.addClass(d),b.val(a(".lsearch-item",e).text()))},loadPage:function(a){var b=a.attr("href");this.destroySearchContainer(),document.location.href=b},destroySearchContainer:function(b){a(".lsearch-results").remove()},validateOnInit:function(a){if(a.minInput<2)throw new Error('Invalid "Minimum Input" option!');if(a.searchDelay=parseInt(a.searchDelay),isNaN(a.searchDelay))throw new Error('Invalid "Search Delay" option!');if(a.limitResult=parseInt(a.limitResult),isNaN(a.limitResult))throw new Error('Invalid "Limit Results" option!');if(!a.url)throw new Error("Url is not defined!");if("function"!=typeof a.beforeRender)throw new Error('"beforeRender" Callback must be specified!');if(!a.data.text||!a.data.href)throw new Error('Attributes "data.text" and "data.href" must be defined!')},destroy:function(){this.$element.empty()}},a.fn.liveSearch=function(b){var d,f=Array.prototype.slice.call(arguments,1),g=a(this),h=g.data("live-search"),i="object"==typeof b&&b;return h||g.data("live-search",h=new e(this,i)),"string"==typeof b&&(d=h[b].apply(h,f)),d===c?g:d},a.fn.liveSearch.defaults={url:"",method:"GET",minInput:2,searchDelay:200,limitResult:10,resultContainer:"lsearch-results",appendContainer:"",beforeRender:null,beforeRequestSend:null,data:{text:"",href:""}},a.fn.liveSearch.Constructor=e,a.fn.liveSearch.noConflict=function(){return a.fn.liveSearch=d,this}}(jQuery,window);